---
title: "Kolera"
author: "Stine Telling"
date: "2025-05-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Installing and loading libraries

```{r, message=TRUE}
library(tidyverse)
library(tidytext)
library(ggwordcloud)
library(urltools)
```

#Loading dataset from mediestream

```{r pressure, echo=FALSE}
link <- "https://labs.statsbiblioteket.dk/labsapi/api/aviser/export/fields?query=%28kolera%20OR%20cholera%29%20AND%20%28k%C3%B8benhavn%20OR%20kj%C3%B8benhavn%29%20AND%20py%3A%5B1850%20TO%201859%5D%20AND%20pu%3Ak%C3%B8benhavn&fields=link&fields=recordID&fields=timestamp&fields=pwa&fields=cer&fields=fulltext_org&fields=pageUUID&fields=editionUUID&fields=titleUUID&fields=editionId&fields=familyId&fields=newspaper_page&fields=newspaper_edition&fields=lplace&fields=location_name&fields=location_coordinates&max=-1&structure=header&structure=content&format=CSV"
```

#Decoding link

```{r setup, include= TRUE}
url_decode(link)
```

#Reading the CSV-file

```{r setup, include= TRUE}
Kolera <- read_csv(link)
```

#Analyzing data from the Mediestream API

```{r setup, include= TRUE}
Kolera %>% 
  count(lplace, sort = TRUE)
head(Kolera)
```

#Sorting by publisher/publishing house

```{r setup, include= TRUE}
Kolera %>%
  count(familyId, sort = TRUE)
```

#Creating a second dataframe called Kolera_tidy \# Each word now has
their own seperate column

```{r setup, include= TRUE}
Kolera_tidy <- Kolera %>%
  unnest_tokens(word, fulltext_org)
```

#Counting the most frequent words, without a stoplist

```{r setup, include= TRUE}
Kolera_tidy %>%
  count(word, sort = TRUE)
```

```{r setup, include= TRUE}
stopord_kolera <- read_csv("stopwordlist.csv")
```

```{r setup, include= TRUE}
Kolera_tidy %>% 
  anti_join(stopord_kolera, by = "word") %>%
  count(word, sort = TRUE)
```

#creating a new dataframe, with a year as a value

```{r setup, include= TRUE}
Kolera_tidy %>% 
  mutate(y=year(timestamp),m = month(timestamp)) -> Kolera_tidy_year
```

#Counting words by year, without stopwordlist

```{r setup, include= TRUE}
Kolera_tidy_year %>% 
  count(word, y, sort = TRUE)
```

#Counting wordfrequencies grouped by year/Y

```{r}
Kolera_tidy_year%>%
  count(word, y) %>%
  group_by(y)%>%
  summarise(total = sum(n)) -> total_words
```

```{r}
Kolera_tidy_year%>%
  count(word, y, sort = TRUE) %>%
  left_join(total_words, by = "y") -> Kolera_year_count

```

```{r setup, include= TRUE}
Kolera_year_count %>%
  anti_join(stopord_kolera, by = "word") %>%
  bind_tf_idf(word, y, n) -> Kolera_year_tf_idf
```

```{r setup, include= TRUE}
Kolera_year_tf_idf %>%
  arrange(desc(tf_idf))
```

```{r setup, include= TRUE}
Kolera_year_tf_idf %>%
  arrange(desc(tf_idf)) %>%
  mutate(word=factor(word, levels = rev(unique(word)))) %>%
  group_by(y) %>%
  top_n(8) %>%
  ungroup %>%
  ggplot(aes(label = word, size = tf_idf, color = tf_idf)) +
  geom_text_wordcloud_area() +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  facet_wrap(~y,ncol=4, scales = "free") + 
  scale_color_gradient(low = "hotpink", high = "lightblue") +
  labs(
    title = "koleraepidemien: most important words pr. year",
    subtitle = "importance determined by term freqency (tf) - inversed document frequency(idf)",
    caption = "Data from Mediestream Experimental API"
  )
```

## Sorting by month instead of year

```{r setup, include= TRUE}
Kolera_tidy %>%
  filter(year(timestamp)==1853) -> Kolera_1853_tidy
```

```{r setup, include= TRUE}
Kolera_1853_tidy %>% 
  count(word, m, sort = TRUE)
```

#Counting wordfrequencies grouped by year/Y

```{r}
Kolera_1853_tidy%>%
  count(word, m) %>%
  group_by(m)%>%
  summarise(total = sum(n)) -> total_words
```

```{r}
Kolera_1853_tidy%>%
  count(word, m, sort = TRUE) %>%
  left_join(total_words, by = "m") -> Kolera_month_1853_count

```

```{r setup, include= TRUE}
Kolera_month_1853_count %>%
  anti_join(stopord_kolera, by = "word") %>%
  bind_tf_idf(word, m, n) -> Kolera_month_1853_tf_idf
```

```{r setup, include= TRUE}
Kolera_month_1853_tf_idf %>%
  arrange(desc(tf_idf))
```

```{r setup, include= TRUE}
Kolera_month_1853_tf_idf %>%
  arrange(desc(tf_idf)) %>%
  mutate(word=factor(word, levels = rev(unique(word)))) %>%
  group_by(m) %>%
  top_n(8) %>%
  ungroup %>%
  ggplot(aes(label = word, size = tf_idf, color = tf_idf)) +
  geom_text_wordcloud_area() +
  scale_size_area(max_size = 10) +
  theme_minimal() +
  facet_wrap(~m,ncol=4, scales = "free") + 
  scale_color_gradient(low = "lightgreen", high = "yellow") +
  labs(
    title = "koleraepidemien: most important words pr. month in 1853",
    subtitle = "importance determined by term freqency (tf) - inversed document frequency(idf)",
    caption = "Data from Mediestream Experimental API"
  )
```
